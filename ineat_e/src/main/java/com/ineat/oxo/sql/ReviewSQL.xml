<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
         PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
         
 <mapper namespace="rvSQL">
 	<insert id="addreview" parameterType="rvVO">
 	<selectKey keyProperty="rv_mno" resultType="int" order="BEFORE">
	SELECT
		M_NO
	FROM
		IE_MEMBER
	WHERE
		M_ID = #{m_id}
 	</selectKey>
 	INSERT INTO
		ie_review(rv_no, rv_mlno, rv_mno, rv_body, rv_date, rv_score)
	VALUES(
    	(SELECT NVL(MAX(rv_no)+1, 100001) from ie_review), #{rv_mlno}, #{rv_mno}, #{rv_body}, sysdate, #{rv_score}
	)
 	</insert>
 	
 	<select id="reviewcnt" parameterType="int" resultType="int">
 	select
		COUNT(*) cnt
	from
		ie_review
	where
		rv_mlno = #{ml_no};
 	</select>
 	
 	<select id="reviewinfo" parameterType="int" resultType="rvVO">
 	SELECT
	    rv_no, rv_mno, rv_body, rv_date, rv_score , (SELECT COUNT(*) FROM ie_re_fileup WHERE rf_rvno = rv_no) cnt
	FROM
	    ie_review
	WHERE
	    rv_mlno = #{ml_no};
 	</select>
 </mapper>