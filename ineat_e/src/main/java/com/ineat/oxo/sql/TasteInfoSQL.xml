<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
         PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
         "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
         
 <mapper namespace="tSQL">
 
 
 	<select id="selectlist" resultType="tVO">
		SELECT  *
		FROM
		(SELECT ml_no, ml_title, ml_newaddr, ml_count ,ROWNUM rno
		FROM ie_mainlist)
        WHERE rno BETWEEN 1 and 5
        order by rno
 	</select>
 	
 	<select id="morelist" resultType="tVO" parameterType="tVO">
		SELECT  *
		FROM
		(SELECT ml_no, ml_title, ml_newaddr, ml_count ,ROWNUM rno
		FROM ie_mainlist
        order by ml_count desc)
		WHERE rno between #{rno} AND #{rno}+4
        order by rno
 	</select>
 	
 	<select id="taglist" resultType="tVO" parameterType="tVO">
		SELECT *
	    FROM(
			SELECT ROWNUM rno, ml_no, ml_title, ml_newaddr, ml_count, ml_tag
			FROM(
				SELECT ml_no, ml_title, ml_newaddr, ml_count, ml_tag
				FROM ie_mainlist
				WHERE ml_tag like '%'||#{ml_tag}||'%'
				order by ml_count desc
				)
			)
		WHERE rno BETWEEN #{rno} and #{rno}+4
 	</select>
 	
 	<update id="upcount" parameterType="int">
 		UPDATE ie_mainlist
 		SET
 			ml_count = ml_count+1
 		WHERE ml_no = #{ml_no}
 	</update>
 	
 	<select id="tasteInfo" resultType="tVO" parameterType="int">
 		SELECT ml_no, ml_time,  ml_title, ml_tel, ml_price, ml_newaddr, ml_oldaddr, ml_menu, ml_count
 		FROM ie_mainlist
 		WHERE ml_no = #{ml_no}
 	</select>
 	
 	<select id="reviewimgs" parameterType="int" resultType="String">
 	SELECT
	    rf_savename
	FROM
	    ie_review , ie_re_fileup
	WHERE
	    rv_mlno = #{ml_no} AND
	    rv_no = rf_rvno(+) AND
	    rv_no = rf_rvno
 	</select>
 	
 	<select id="checkfavorite" parameterType="tVO" resultType="int">
	 		SELECT
    			count(*)
			FROM
			    IE_ML_FAVORITES
			WHERE
			    MLF_MNO = (SELECT m_no
			            FROM ie_member
			            WHERE m_id = #{m_id}) AND
				MLF_MLNO = #{ml_no}
	 	</select>
 	
 	<insert id="" parameterType="tVO">
 		INSERT INTO
		ie_review(rv_no, rv_mlno, rv_mno, rv_body, rv_date, rv_score)
	VALUES(
    	(SELECT NVL(MAX(rv_no)+1, 100001) from ie_review), #{rv_mlno}, #{rv_mno}, #{rv_body}, sysdate, #{rv_score}
	)
 	</insert>
 </mapper>